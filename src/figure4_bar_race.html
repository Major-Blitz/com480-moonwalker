<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Developer Sales Chart</title>
  <!-- 引入 ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.2/dist/echarts.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="acrossStyle">
    <div id="acrossChart" style="width: 100%; height: 100%;"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      $.getJSON('../datasets/developer-sales.json', function(dataArr) {
        const developerColors = {
          Nintendo: "#e60012",  // Nintendo
          Sega: "#008952",      // Sonic the Hedgehog
          "Acclaim Entertainment": "#e60000",  // Mortal Kombat
          "Sony Computer Entertainment": "#003087",  // PlayStation
          "Hudson Soft": "#eb3349",  // Bomberman
          Activision: "#0066cc",   // Call of Duty
          LucasArts: "#0095d9",    // Star Wars
          SNK: "#008000",          // King of Fighters
          "Human Entertainment": "#fbec5d",  // Fire Pro Wrestling
          "Electronic Arts": "#d93e1e",       // FIFA
          Ubisoft: "#28b4b4",      // Assassin's Creed
          "Crystal Dynamics": "#990000",      // Tomb Raider
          Atlus: "#ffcc33",        // Persona
          Capcom: "#007fff",       // Street Fighter
          Natsume: "#ff99ff",      // Harvest Moon
          Maxis: "#67c2b0",        // SimCity
          Codemasters: "#6b8e23",  // Dirt
          "UEP Systems": "#cccccc", // LittleBigPlanet
          THQ: "#4169e1",          // Saints Row
          "989 Studios": "#cc0000",  // Syphon Filter
          "Midway Games": "#8b4513",  // Mortal Kombat
          Atari: "#fdb913",          // Pong
          "Square Enix": "#ff6f61",  // Final Fantasy
          "Disney Interactive Studios": "#005bab",  // Disney
          "Warner Bros.": "#1547e8",  // Batman
          "Bethesda Softworks": "#232b2b"   // Elder Scrolls
        };

        const myChart = echarts.init(document.getElementById("acrossChart"));
        const updateFrequency = 2000;
        let currentIndex = 0;

        function updateData() {
          const year = dataArr[currentIndex];
          const cname = year.cname.split(",");
          const sales = year.sales.split(",").map(Number);

          const option = {
            grid: {
              left: '15%',
              right: '15%'
            },
            xAxis: {
              max: "dataMax",
              splitLine: {
                show: true,
              },
              axisLabel: {
                formatter: (n) => Math.round(n) + "",
              },
            },
            yAxis: {
              type: "category",
              inverse: true,
              max: 10,
              data: cname,
              axisLabel: {
                show: true,
                fontSize: 14,
                rich: {
                  bold: {
                    fontWeight: 'bold'
                  }
                },
                formatter: function (value) {
                  return `{bold|${value.trim()}}`;
                }
              },
              animationDuration: 300,
              animationDurationUpdate: 300,
            },
            series: [
              {
                realtimeSort: true,
                seriesLayoutBy: "column",
                type: "bar",
                itemStyle: {
                  color: function (param) {
                    const developerName = cname[param.dataIndex].trim();
                    const color = developerColors[developerName] || '#000';
                    return color;
                  },
                },
                label: {
                  show: true,
                  precision: 2,
                  position: "right",
                  valueAnimation: true,
                  fontFamily: "monospace",
                  formatter: `{c} millions`,
                },
                data: sales,
              },
            ],
            animationDuration: 600,
            animationDurationUpdate: 600,
            animationEasing: "linear",
            animationEasingUpdate: "linear",
            graphic: {
              elements: [
                {
                  type: "text",
                  right: 160,
                  bottom: 60,
                  style: {
                    text: year.cdate,
                    font: "bolder 60px monospace",
                    fill: "rgba(100, 100, 100, 0.25)",
                  },
                  z: 100,
                },
              ],
            },
          };
          myChart.setOption(option);
          currentIndex = (currentIndex + 1) % dataArr.length;
        }

        setInterval(updateData, updateFrequency);
        updateData(); 
        window.addEventListener("resize", () => {
          myChart.resize();
        });
      });
    });
  </script>

  <style>
    .acrossStyle {
      width: 80%;
      height: 50vh;
      margin: 0 auto;
    }
  </style>
</body>
</html>
